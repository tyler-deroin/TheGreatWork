---
title: "Divorce and its Causes in the United Kingdom"
author: "Team M"


date: "October 13, 2017"
output:
  pdf_document:
    toc: true
    toc_depth: 2
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, messages = FALSE, warning = FALSE)
```


\newpage
# Introduction
Marriage is viewed by many as an important social and sometimes religious life event for a majority of people.  It symbolizes and unites two individuals into a single-family unit of everlasting bliss. Tragically, for some marriages face the reality that they were not meant to last and either officially through divorce or unofficially through separation. Since the United Kingdom divorce rate hit its peak in 2003, it has steadily dropped to NUMBER HERE (Haines, 2017) and CITATION NUMBER.  This drop has been attributed to culture changes around cohabitation, "couples living together before getting married" (Bingham, 2015). 

Despite the wonderful change in the overall divorce rate, there are still many new divorces and separations each year leading us to wonder what could still cause such a travesty. Our curiosity and ultimately investigation is to find the remaining factors still bringing about the decline and end of family units across the United Kingdom based on the 2011 Census data. 



# Description
The dataset we examined is the 5% sample data of the 2011 UK Census. It contains 2,848,155 observations and 121 variables. Each observation represents a UK citizen
Since the dataset is very large and there are too many variables, we decided to exclusively focus on the relationship between marital status (marstat) and other variables. In brief, we would like to examine the factors that may influence people's marriage and lead to higher divorce rate. Therefore, we selected a total of 17 variables that may be highly correlated with marital status.


We can attach a table of all variables we examined here:




# Methods 
a really brief description of the R packages we used. We can load all our libraries in this page:
```{r, echo = TRUE, eval = FALSE, results='hide', messages = FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)
library(gridExtra)
library(stargazer)
library(readr)
library(RCurl)
library(foreign)

```

```{r, eval = TRUE, echo=FALSE}
suppressPackageStartupMessages(library(dplyr, quietly=TRUE))
library(ggplot2)
suppressPackageStartupMessages(library(gridExtra, quietly=TRUE))
suppressPackageStartupMessages(library(stargazer, quietly=TRUE))
suppressPackageStartupMessages(library(readr, quietly=TRUE))
suppressPackageStartupMessages(library(RCurl, quietly=TRUE))
suppressPackageStartupMessages(library(foreign, quietly=TRUE))
```


```{r}
# Load data
url <- "https://raw.githubusercontent.com/dlouhasha/TheGreatWork/master/data/filtered_dataset.csv"
filtered_data <- getURL(url)
filtered_data <- read.csv(textConnection(filtered_data))

fd <- filtered_data
fd <- as.data.frame(fd)

```

In our report we aim to explore how selected variables singularly and collectively affect the probability of an individual being divorced or separated. 

In the first part of the report we explore the interactions between selected variables and divorce rate. The divorce rate is calculated as percentage of unhappy marriages over total marriages,
$$(divorced + separated)/(married + samesex + divorced + separated)$$

We include separated in our definition of unhappy marriage because sometimes people continue to stay in marriage for practical reasons such as cohabitating and tax benefits, but that is more form over substance and most separated couples end up in divorce. Our team is particularly interested in the factors that lower people's marriage satisfaction which eventually lead to divorce. 

The variables we select include inherent characteristics of an individual such as age, ethinicity, religion and country of birth, characteristics an individual acquire such as social grade, highest qualification achieved, and disability and lastly external factors such as region and type of housing. 

Exploratory statistics includes mostly plotting. Bar plots are used when we want to represent the divorce rates for different classes of each variable, for example highest qualification achieved ranges from no qualification to level 4 (university and above). When we want to explore the interactions between more than one variables, we use color to represent them on the graph or use a grid to lay multiple small scale plots next to each other in order to identify any difference in pattern. 

Hypothesis testing is also used to test if the observed pattern is statistically significant. Chi-squared test is used to explore whether two categorical variables are independent. Correlation test is used for testing correlations between two samples. Since most of our variables are categorical and marital status is categorical, chi-squared test is the best choice in our analysis. T-test is used for testing of difference in divorce rates across classes of variables. We ust 5% significance level for all the hypothesis testing done in this research. If the p-value from the test is less than 5%, we can confidently reject the null hypothesis. 



In our report we aim to explore how selected variables singularly and collectively affect the probability of an individual being divorced or separated. 

In the first part of the report we explore the interactions between selected variables and divorce rate. The divorce rate is calculated as percentage of unhappy marriages over total marriages,
$$(divorced + separated)/(married + samesex + divorced + separated)$$

We include separated in our definition of unhappy marriage because sometimes people continue to stay in marriage for practical reasons such as cohabitating and tax benefits, but that is more form over substance and most separated couples end up in divorce. Our team is particularly interested in the factors that lower people's marriage satisfaction which eventually lead to divorce. 

The variables we select include inherent characteristics of an individual such as age, ethinicity, religion and country of birth, characteristics an individual acquire such as social grade, highest qualification achieved, and disability and lastly external factors such as region and type of housing. 

Exploratory statistics includes mostly plotting. Bar plots are used when we want to represent the divorce rates for different classes of each variable, for example highest qualification achieved ranges from no qualification to level 4 (university and above). When we want to explore the interactions between more than one variables, we use color to represent them on the graph or use a grid to lay multiple small scale plots next to each other in order to identify any difference in pattern. 

Hypothesis testing is also used to test if the observed pattern is statistically significant. Chi-squared test is used to explore whether two categorical variables are independent. Correlation test is used for testing correlations between two samples. Since most of our variables are categorical and marital status is categorical, chi-squared test is the best choice in our analysis. T-test is used for testing of difference in divorce rates across classes of variables. We ust 5% significance level for all the hypothesis testing done in this research. If the p-value from the test is less than 5%, we can confidently reject the null hypothesis. 



```{r, echo = FALSE}
# changing the factor names 
fd[, 'region'] <- factor(fd[,'region'], levels = c(1, 2, 3, 4, 5, 6, 7,
                                                       8, 9, 10, 11), 
                           labels = c('North East', 'North West', 'Yorkshire and the Humber', 
                                      'East Midlands', 'West Midlands', 'East of England', 
                                      'Inner London',
                                      'Outer London', 'South East', 'South West', 'Wales'))

fd <- fd %>% mutate('binary_region_num' = ifelse(region == 'Inner London', 1, 0)) %>% mutate( 'binary_region_factor' = ifelse(region == 'Inner London', "Inner London", "Outside London"))


fd[,'marstat'] <- factor(fd[,'marstat'], level = c(1,2,3,4,5,6), 
                           labels = c('Single', 'Married', 'Same-sex', 'Separated', 
                                      'Divorced', 'Widowed'))

fd <- mutate(fd, 'binary_marstat' = ifelse(marstat == "Separated" | marstat == 'Divorced', 1, 0))

fd[,'transport']<- factor(fd[,'transport'], levels = c(1, 2, 3, 4, 5, 6, 7,
                                                           8, 9, 10, 11), 
                            labels = c('Work from home', 'metro', 'Train', 'Bus',
                                       'Taxi', 'Motocycle', 'drive a car', 'passenger in a car', 
                                       'Bicycle', 'On foot', 'Other'))

fd[,'wpzhome'] <- factor(fd[,'wpzhome'], level = c(1,2,3,4,5), 
                           labels = c('Work from home', 'Same zone', 'Outside zone, but same LA/UA district',
                                      'Outside LA/UA/LGD', 'Workplace outside UK'))

fd[,'aggdtwpew11g'] <- factor(fd[,'aggdtwpew11g'], level = c(1, 2, 3, 4, 5, 6, 7,
                                                                 8, 9, 10, 11, 12), 
                                labels = c('less than 2km', '2-5', '5-10', '10-20', 
                                           '20-40', '40-60', '60 or more', 'at home', 
                                           'No fixed place', 'Outside England and Wales but in UK', 
                                           'Outside UK', 'Offshore but within UK'))

fd <- mutate(fd, Highest_qualification = hlqupuk11)
fd[,'Highest_qualification'] <- factor(fd[,'Highest_qualification'], 
                                            levels = c(10, 11, 12, 13, 14, 15, 16), labels = c('No qualification', 'Level 1', 'Level 2', 'Apprenticeship','Level 3', 'Level 4', 'Others'))

fd[,'hours']<- factor(fd[,'hours'], level= c(1,2,3,4), labels = c('15 or less', '16-30', '31-48','49 or more'))

fd[, 'tenure'] <- factor(fd[,'tenure'], levels = c(1, 2, 3, 4, 5), 
                           labels = c('Owns outright', 'Owns with a mortgage', 'Shared ownership', 'Rents', 'Rent-free'))

fd <- fd%>% mutate(no_of_children = dpcfamuk11)%>% mutate(children_class = ifelse(dpcfamuk11==1, '0.No children', ifelse(dpcfamuk11==2|dpcfamuk11==3|dpcfamuk11==4|dpcfamuk11==5|dpcfamuk11==6|dpcfamuk11==7, '1.One child', ifelse(dpcfamuk11==8|dpcfamuk11==9|dpcfamuk11==10|dpcfamuk11==11|dpcfamuk11==12|dpcfamuk11==13, '2.Two children', ifelse(dpcfamuk11==14|dpcfamuk11==15|dpcfamuk11==16|dpcfamuk11==17|dpcfamuk11==18|dpcfamuk11==19, '3.Three or more children', NA)))))

fd <- fd %>% mutate(youngest_child_age = ifelse(dpcfamuk11==1, '0.No children', ifelse(dpcfamuk11==2|dpcfamuk11==8|dpcfamuk11==14, '1.youngest aged 0-4', ifelse(dpcfamuk11==3|dpcfamuk11==9|dpcfamuk11==15, '2.youngest aged 5-7', ifelse(dpcfamuk11==4|dpcfamuk11==10|dpcfamuk11==16, '3.youngest aged 8-9', ifelse(dpcfamuk11==5|dpcfamuk11==11|dpcfamuk11==17, '4.youngest aged 10-11', ifelse(dpcfamuk11==6|dpcfamuk11==12|dpcfamuk11==18, '5.youngest aged 12-15', ifelse(dpcfamuk11==7|dpcfamuk11==13|dpcfamuk11==19, '6.youngest aged 16-18', NA))))))))

```

# Descriptive Statistics and Correlation Tests
Simple descriptive statistis including bar charts, pie charts, density graph... etc. 
We can show a few correlation tests, chi-squre tests and graphs

## Social and Economic Status & Marriage 

```{r}
census <- filtered_data
census$ethnicityew <- factor(census$ethnicityew, levels = seq(1,18), labels = c("English/Welsh/Scottish/Northern Irish/British", 
"Irish", 
"Gypsy or Irish Traveller", 
"Other White", 
"Mixed/multiple ethnic group: White and Black Caribbean", 
"Mixed/multiple ethnic group: White and Black African", 
"Mixed/multiple ethnic group: White and Asian", 
"Mixed/multiple ethnic group: Other Mixed", 
"Indian", 
"Pakistani", 
"Bangladeshi", 
"Chinese", 
"Other Asian", 
"African", 
"Caribbean", 
"Other Black", 
"Arab", 
"Any other ethnic group"))

#1: white 2: Asian 3: black 4: Arab 5: other

census$ethngrouped <- census$ethnicityew

census$ethngrouped <- ifelse(census$ethnicityew == "English/Welsh/Scottish/Northern Irish/British"  | census$ethnicityew == "Irish" | census$ethnicityew == "Gypsy or Irish Traveller"| census$ethnicityew == "Other White", 1, 
                                ifelse( census$ethnicityew == "Indian" | census$ethnicityew == "Pakistani"| census$ethnicityew == "Bangladeshi" | census$ethnicityew == "Chinese"| census$ethnicityew == "Other Asian", 2, 
                                        ifelse(census$ethnicityew == "African" | census$ethnicityew == "Caribbean"| census$ethnicityew == "Other Black", 3, 
                                               ifelse(census$ethnicityew == "Arab", 4, 
                                                      ifelse(census$ethnicityew == "other", "Any other ethnic group", 5)))))


census$religionew <- factor(census$religionew, levels = seq(1,9), labels = c("No religion", 
"Christian", 
"Buddhist", 
"Hindu", 
"Jewish", 
"Muslim", 
"Sikh", 
"Other religion", 
"Not stated"))

cen <- select(census, caseno, marstat, hlqupuk11, scgpuk11c)
cen$separated <- cen$marstat
cen <- cen %>% mutate(separated = replace(separated, marstat == 2 | marstat == 3, 0))
cen <- cen %>% mutate(separated = replace(separated, marstat == 5 | marstat == 4, 1))
colnames(cen) <- c("ID", "marstat", "education", "social_grade", "separated")
#replace -9 with NA 
cen_f <- cen %>% mutate_all(funs(replace(., . == -9, NA)))
cen_f <- cen_f %>% filter(!is.na(social_grade), !is.na(education), !(education == 16))
dim(cen_f)

```


After filtering out people whose education level cannot be interpretated and filtering out missing values 1.684.636 observations are left. 
The distribution between social grades is alike.
Education on the other hand has as significant underrepresentation of participants that absolved an apprenticeship. They account for less than 4 % of the surveyed participants . This should be kept in mind when interpreting divorcerates in the apprenticeship group.


Between education and social grade is a middle strong linear correlation. The higher the education level the higher the social grade.  Still it is insightful to look at both variables alone and combined, as they give different insights.
```{r}
#quick look at distributions
table(cen_f$separated)
addmargins(prop.table(table(cen_f$separated)))
table(cen_f$education)
prop.table(table(cen_f$education))
```


```{r}
#correlate independend variables 
social_plot <- ggplot(cen_f, aes(x = factor(education), y = social_grade))
social_plot +
  geom_histogram(stat = "summary", fun.y = "mean", fill = "cadetblue3") +
  xlab ("Education level") +
  ylab("Average social Grade (1:highest 4: lowest)") +
  scale_x_discrete(labels = c("10" = "none", "11" = "O levels / GCSE", "12" = "CSE / GCSE grade 1 / A", "13" = "apprenticeship", "14" = "A levels", "15" = "university degree")) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


cen_f %>% group_by(education) %>% summarise(n = n(), mean_grade = mean(social_grade, na.rm = TRUE))

#Spearmans ran correlation coefficient (cor between two comparative variables)
cor(cen_f$social_grade, cen_f$education, method = "spearman", use="p")

```



```{r, echo=FALSE}

#Plot divorce rate per social grade

educ <- cen_f %>% group_by(education) %>% summarise(n = n(), separated = sum(separated), rel_div = (separated / n)*100)

soclass <- cen_f %>% filter(!is.na(social_grade)) %>% group_by(social_grade) %>% summarise(n = n(), separated = sum(separated), rel_div = (separated / n)*100)

soclass_plot <- ggplot(soclass, aes(x = factor(social_grade), y = rel_div))
soclass_plot  +
  geom_col(fill  = "cadetblue3") +
  xlab("Social grade") +
  ylab("Divorce rate in percent") +
  scale_x_discrete(labels = c("1" = "AB", "2" = "C1", "3" = "C2", "4" = "DE")) +
  scale_y_continuous(limits = c(0, 33), breaks = seq(0, 33, 5))

```


For social grade the finding match the underlying hypothesis fundamentally. 
Social grade is directly connected to living standarts.Society holds the common belief that money is the root of all marriage problems. Nevertheless, there a few studies supporting this theory and many contradicting it (Andersen, 2008).
http://www.tandfonline.com/doi/abs/10.1300/J087v43n01_08  According to the UK census data, this assumption seems to prove true: the lowest social grade has an above average divorce rate of 33 % versus 13 % for the upper and middle class. Only between social grade C1 and C2 the pattern does not apply. C2 has a 4% lower divorce rate compared to C1. But still, both lie in the middle of AB and DE and are close to the total verage divorce rate of 21 %.

To see if the social grade is a true indicator for divorce and not only related to the fact, that migrants, different religions or higher educated, who tend to have a lower divorce rate than the Britishs, are overrepresented in some social groups, the data was crosschecked with religion as well as ethnicity. 

The exact same pattern, also with C1 being slightly higher than C2 holds across all religions, ethnicities and education levels. Therefore it can be conlcuded, that social grade has a direct influence on the divorcerate. Upper and middle class have a way lower probability of getting divorced than all other groups. 
A meaningful factor is the higher income, which enables better housing, better healthcare, less stressful life, more security and therefore less severe problems affecting the average marriage. 
Next to monetary problems, lower social groups tend to have a higher probability of drug and alcohol problem, one of the major reasons for divorce (NHS 2014; Trail and Karney, 2012). Additionally, earlier marriages, which will be explained in the education evaluation, are a burden for marriages.

http://digital.nhs.uk/catalogue/PUB15943
http://onlinelibrary.wiley.com/doi/10.1111/j.1741-3737.2012.00977.x/full

Across all sociodemographic characteristics (religion, ethnicity, education levels) the lowest social grade always has a significantly higher divorce rate and the highest social grade the lowest divorce rate. Overall it can be concluded that social grade, which is highly correlated with income, is a strong driver for divorces. 
The difference between social grade C1 and C2, which is as well constant across different sociodemographic groups, is a question for further research and could not be evaluated based on the census data. 


## Education
```{r}
#plot distribution of divorce per education level

#rel_div: percen_f_ft of divorce per education group
edu_plot <- ggplot(educ, aes(x = factor(education)))
edu_plot + 
  geom_col(aes(y = rel_div), fill = "cadetblue3") +
  geom_blank() +
  scale_x_discrete(labels = c("10" = "none", "11" = "O levels / GCSE", "12" = "CSE / GCSE grade 1 / A", "13" = "apprenticeship", "14" = "A levels", "15" = "university degree")) +
  scale_y_continuous(limits = c(0, 30), breaks = seq(0, 30, 3)) +
  ggtitle("Divorce rate per education level") +
  xlab ("Education level") +
  ylab ("Divore rate in %") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```


The graph clearly confirms our expetations: the higher educated the lower the divorce rate. As can be seen, the difference in divorce rate between no degree and a university degree is about 10%. 
People with no education have a divorce rate of 28 %, univeristy graduates 17 %. People with a school education approach the mean divorce rate of 21 % the higher their school degree is. 

A reason for the negative correlation directly linked to education, is that higher educated people marry later than less educated people. A reason for  marrying later the higher educated someone is, is that the education lasts longer and therefore "adult life" and a stable lifestyle starts later. More educated people tend to focus more on their career in their joung ages.  Especially for women, a higher education results in a higher independence which lowers her feeling of need for getting married early (Isen, 2010).
Additionally, higher educated people are in a relatioship and live together longer time before getting married. Knowledge about the partner, expectations and security if both share the same ideas for the future grow with age  and experienced with each other.  https://www.theguardian.com/lifeandstyle/2009/sep/27/divorce-linked-to-age-education http://www.nber.org/papers/w15725.pdf
Furthermore, being pregnant or having children is still a reason for early marriage which results in a higher divorce rate. As less educated women tend to have children when their younger, they marry earlier because of the child (Office for National Statistics, 2015).

A result from the higher education is a better financial situation which lowerst the divorse rate, as seen in the social grade analysis. As 80% of the people marry in their own social category, the gap between income and education between different couples grow even stronger.

http://www.sueddeutsche.de/wirtschaft/partnerwahl-und-ungleichheit-heiraten-zementiert-soziale-spaltung-1.1875581 (http://www.pewresearch.org/fact-tank/2015/12/04/education-and-marriage/)

https://www.ons.gov.uk/peoplepopulationandcommunity/birthsdeathsandmarriages/livebirths/bulletins/birthsbyparentscharacteristicsinenglandandwales/2015

By looking at the relation between divorce rate and education across different religions and ethnic groups, it can be seen that the negative correlation holds. Education therefore seems to be a driver for divorce independend of the religion and ethnicity.
This strong pattern diminishes when looking at the highest degree in every social group. The negative correlation is still present, but as education is highly inequaly distributed among social grades, social grade acts as a confuncing variable.
The strong pattern of a lower divorce rate in the social group AB is partly driven by the majority of the people belonging to this social class being higly educated 

It can therefore be concluded that both, education and social grade, are strong driver of divorce.The unequally ditributed educaiton levels within social classes reinforce this effect. 
The highest overall divorce rate of 34% is thus in the lowest social grade group for people with no education at all. 
This effect is reinforced for black people in the lowest social grade with no education. Their divorce rate is 37% on average. With a divorce rate of only 6% highly educated Asians in the AB social group hold the lowest divorce rate. 

The average british person is white, christian, belongs to the middle class and has a university degree has a average divorce rate of 12 %. 
By only changing education (but keeping social class) the divorce rate ascends to 14.5 %.
When looking for both education extremes in the lowest social class we get a divorce rate for university graduates of 24 % versus 35 % for non educated people. It can be seen by this, that social grade accounts for higher differences in divorce rate than education does. 


```{r}
#grouping ethnicity
census$ethngrouped <- census$ethnicityew

census$ethngrouped <- ifelse(census$ethnicityew == "English/Welsh/Scottish/Northern Irish/British"  | census$ethnicityew == "Irish" | census$ethnicityew == "Gypsy or Irish Traveller"| census$ethnicityew == "Other White", 1, 
                                ifelse( census$ethnicityew == "Indian" | census$ethnicityew == "Pakistani"| census$ethnicityew == "Bangladeshi" | census$ethnicityew == "Chinese"| census$ethnicityew == "Other Asian", 2, 
                                        ifelse(census$ethnicityew == "African" | census$ethnicityew == "Caribbean"| census$ethnicityew == "Other Black", 3, 
                                               ifelse(census$ethnicityew == "Arab", 4, 
                                                      ifelse(census$ethnicityew == "other", "Any other ethnic group", 5)))))


educ <- cen_f %>% group_by(education, social_grade) %>% summarise(n = n(), separated = sum(separated), rel_div = (separated / n)*100) %>% mutate(sg = n/sum(n))

#add seperation per social grade 

edu_plot <- ggplot(educ, aes(x = factor(education), y = rel_div, fill = factor(social_grade)))
edu_plot + 
  geom_col(stat = "identity", position = "dodge") +
  scale_x_discrete(labels = c("10" = "none", "11" = "O levels / GCSE", "12" = "CSE / GCSE grade 1 / A", "13" = "apprenticeship", "14" = "A levels", "15" = "university degree")) +
  scale_y_continuous(limits = c(0, 35), breaks = seq(0, 35, 3)) +
  ggtitle("Divorce rate per education level") +
  xlab ("Education level") +
  ylab ("Divore rate in %") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#plot with facet_grid per social grade 
####
edu_plot <- ggplot(educ, aes(x = factor(education), y = rel_div, fill = factor(social_grade)))
edu_plot + 
  geom_col(stat = "identity") +
  scale_x_discrete(labels = c("10" = "none", "11" = "O levels / GCSE", "12" = "CSE / GCSE grade 1 / A", "13" = "apprenticeship", "14" = "A levels", "15" = "university degree")) +
  scale_y_continuous(limits = c(0, 35), breaks = seq(0, 35, 2.5)) +
  ggtitle("Divorce rate per education level and social grade") +
  xlab ("Education level") +
  ylab ("Divore rate in %") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  facet_grid(~social_grade)

#plot education per social grade, no divorce rate
edu_plot <- ggplot(educ, aes(x = factor(education), y =n, fill = factor(social_grade)))
edu_plot + 
  geom_col(stat = "identity") +
  scale_x_discrete(labels = c("10" = "none", "11" = "O levels / GCSE", "12" = "CSE / GCSE grade 1 / A", "13" = "apprenticeship", "14" = "A levels", "15" = "university degree")) +
  ggtitle("Divorce rate per education level and social grade") +
  xlab ("Education level") +
  ylab ("Count") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  facet_grid(~social_grade)
```




```{r}
educ <- cen_f %>% group_by(education, social_grade) %>% summarise(n = n(), separated = sum(separated), rel_div = (separated / n)*100) %>% mutate(sg = n/sum(n))

#add seperation per social grade 

edu_plot <- ggplot(educ, aes(x = factor(education), y = rel_div, fill = factor(social_grade)))
edu_plot + 
  geom_col(stat = "identity", position = "dodge") +
  scale_x_discrete(labels = c("10" = "none", "11" = "O levels / GCSE", "12" = "CSE / GCSE grade 1 / A", "13" = "apprenticeship", "14" = "A levels", "15" = "university degree")) +
  scale_y_continuous(limits = c(0, 35), breaks = seq(0, 35, 3)) +
  ggtitle("Divorce rate per education level") +
  xlab ("Education level") +
  ylab ("Divore rate in %") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#plot with facet_grid per social grade 
####
edu_plot <- ggplot(educ, aes(x = factor(education), y = rel_div, fill = factor(social_grade)))
edu_plot + 
  geom_col(stat = "identity") +
  scale_x_discrete(labels = c("10" = "none", "11" = "O levels / GCSE", "12" = "CSE / GCSE grade 1 / A", "13" = "apprenticeship", "14" = "A levels", "15" = "university degree")) +
  scale_y_continuous(limits = c(0, 35), breaks = seq(0, 35, 2.5)) +
  ggtitle("Divorce rate per education level and social grade") +
  xlab ("Education level") +
  ylab ("Divore rate in %") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  facet_grid(~social_grade)
```


```{r}
census$region <- factor(census$region, levels = c(1, 2, 3, 4, 5, 6, 7,
                                                       8, 9, 10, 11), 
                           labels = c('North East', 'North West', 'Yorkshire and the Humber', 
                                      'East Midlands', 'West Midlands', 'East of England', 
                                      'Inner London',
                                      'Outer London', 'South East', 'South West', 'Wales'))
cen <- select(census, caseno, marstat, hlqupuk11, scgpuk11c)
cen$separated <- cen$marstat
cen <- cen %>% mutate(separated = replace(separated, marstat == 2 | marstat == 3, 0))
cen <- cen %>% mutate(separated = replace(separated, marstat == 5 | marstat == 4, 1))
colnames(cen) <- c("ID", "marstat", "education", "social_grade", "separated")
#replace -9 with NA 
cen_f <- cen %>% mutate_all(funs(replace(., . == -9, NA)))
cen_f <- cen_f %>% filter(!is.na(social_grade), !is.na(education), !(education == 16))
dim(cen_f)

```


For education level "other" is a foreign degree and therefore not applicable and excluded. Attenteion when we look at immigration backround, as those people might be crossing. 

Social grade: 
1 AB (highest)
2 C1
3 C2
4 DE (lowest)
-9 were excluded as it represents "persons resident in a communal establishment OR persons aged under 16 OR persons aged over 64 OR student/schoolchild living away during term-time OR short-term migrant" (Attention when we match with other data which might include people over 64)

After filtering out people whose education level cannot be interpretated and filtering out missing values 1.684.636 observations are left. 

```{r}
#quick look at distributions
table(cen_f$separated)
addmargins(prop.table(table(cen_f$separated)))
table(cen_f$education)
table(cen_f$social_grade)
```
```{r}
#correlate independend variables 

social_plot <- ggplot(cen_f, aes(x = factor(education), y = social_grade))
social_plot +
  geom_histogram(stat = "summary", fun.y = "mean", fill = "cadetblue3") +
  xlab ("Education level") +
  ylab("Average social Grade (1:highest 4: lowest)") +
  scale_x_discrete(labels = c("10" = "none", "11" = "O levels / GCSE", "12" = "CSE / GCSE grade 1 / A", "13" = "apprenticeship", "14" = "A levels", "15" = "university degree")) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


cen_f %>% group_by(education) %>% summarise(n = n(), mean_grade = mean(social_grade, na.rm = TRUE))

#Spearmans ran correlation coefficient (cor between two comparative variables)
cor(cen_f$social_grade, cen_f$education, method = "spearman", use="p")

```

The data shows, that the higher the education, the higher the social grade. Exept for people who did an apprenticeship. they have a slighltly lower social grade than people with CSE/GCSE. 
There is a middle strong linear correlation between social graed and education level. The higher the education level the higher the social grade. 


```{r}
educ <- cen_f %>% group_by(education) %>% summarise(n = n(), separated = sum(separated), rel_div = (separated / n)*100)

#plot distribution of divorce per education level
#rel_div: percen_f_ft of divorce per education group
edu_plot <- ggplot(educ, aes(x = factor(education)))
edu_plot + 
  geom_col(aes(y = rel_div), fill = "cadetblue3") +
  geom_blank() +
  scale_x_discrete(labels = c("10" = "none", "11" = "O levels / GCSE", "12" = "CSE / GCSE grade 1 / A", "13" = "apprenticeship", "14" = "A levels", "15" = "university degree")) +
  scale_y_continuous(limits = c(0, 30), breaks = seq(0, 30, 3)) +
  ggtitle("Divorce rate per education level") +
  xlab ("Education level") +
  ylab ("Divore rate in %") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
#Divorce rate per social grade divided by education 

educ <- cen_f %>% group_by(education, social_grade) %>% summarise(n = n(), separated = sum(separated), rel_div = (separated / n)*100) %>% mutate(sg = n/sum(n))

#add seperation per social grade 

edu_plot <- ggplot(educ, aes(x = factor(education), y = rel_div, fill = factor(social_grade)))
edu_plot + 
  geom_col(stat = "identity", position = "dodge") +
  scale_x_discrete(labels = c("10" = "none", "11" = "O levels / GCSE", "12" = "CSE / GCSE grade 1 / A", "13" = "apprenticeship", "14" = "A levels", "15" = "university degree")) +
  scale_y_continuous(limits = c(0, 35), breaks = seq(0, 35, 3)) +
  ggtitle("Divorce rate per education level") +
  xlab ("Education level") +
  ylab ("Divore rate in %") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#plot with facet_grid per social grade 
####
edu_plot <- ggplot(educ, aes(x = factor(education), y = rel_div, fill = factor(social_grade)))
edu_plot + 
  geom_col(stat = "identity") +
  scale_x_discrete(labels = c("10" = "none", "11" = "O levels / GCSE", "12" = "CSE / GCSE grade 1 / A", "13" = "apprenticeship", "14" = "A levels", "15" = "university degree")) +
  scale_y_continuous(limits = c(0, 35), breaks = seq(0, 35, 2.5)) +
  ggtitle("Divorce rate per education level and social grade") +
  xlab ("Education level") +
  ylab ("Divore rate in %") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  facet_grid(~social_grade)
  
```


```{r}
soclass <- cen_f %>% filter(!is.na(social_grade)) %>% group_by(social_grade) %>% summarise(n = n(), separated = sum(separated), rel_div = (separated / n)*100)

soclass_plot <- ggplot(soclass, aes(x = factor(social_grade), y = rel_div))
soclass_plot  +
  geom_col(fill  = "cadetblue3") +
  xlab("Social grade") +
  ylab("Divorce rate in percent") +
  scale_x_discrete(labels = c("1" = "AB", "2" = "C1", "3" = "C2", "4" = "DE")) +
  scale_y_continuous(limits = c(0, 33), breaks = seq(0, 33, 5))
```

```{r}
#cen_r: data set with regions to cross check 
cen_r <- select(census, caseno, marstat, hlqupuk11, scgpuk11c, region)

cen_r$separated <- cen_r$marstat
cen_r <- cen_r %>% mutate(separated = replace(separated, marstat == 2 | marstat == 3, 0))
cen_r <- cen_r %>% mutate(separated = replace(separated, marstat == 5 | marstat == 4, 1))
colnames(cen_r) <- c("ID", "marstat", "education", "social_grade", "region", "separated")
#replace -9 with NA 
cen_r <- cen_r %>% mutate_all(funs(replace(., . == -9, NA)))
cen_r <- cen_r %>% filter(!is.na(social_grade), !is.na(education), !is.na(region), !(education == 16))
dim(cen_f)

```


```{r}
#Social grade education and region

region <- cen_r %>% group_by(region, education, social_grade) %>% summarise(n = n(), separated = sum(separated), rel_div = (separated / n)*100) %>% mutate(sg = n/sum(n))


rp <- ggplot(region, aes(x = factor(education), y = rel_div, fill = factor(social_grade)))
rp + 
  geom_col(stat = "identity", position = "dodge") +
  scale_x_discrete(labels = c("10" = "none", "11" = "O levels / GCSE", "12" = "CSE / GCSE grade 1 / A", "13" = "apprenticeship", "14" = "A levels", "15" = "university degree")) +
  scale_y_continuous(limits = c(0, 45), breaks = seq(0, 45, 3)) +
  ggtitle("Divorce rate per education level and region") +
  xlab ("Education level") +
  ylab ("Divore rate in %") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  facet_wrap(~ region)
```



```{r}
#social grade per ethnicity

census$ethnicityew <- factor(census$ethnicityew, levels = seq(1,18), labels = c("English/Welsh/Scottish/Northern Irish/British", 
"Irish", 
"Gypsy or Irish Traveler", 
"Other White", 
"Mixed/multiple ethnic group: White and Black Caribbean", 
"Mixed/multiple ethnic group: White and Black African", 
"Mixed/multiple ethnic group: White and Asian", 
"Mixed/multiple ethnic group: Other Mixed", 
"Indian", 
"Pakistani", 
"Bangladeshi", 
"Chinese", 
"Other Asian", 
"African", 
"Caribbean", 
"Other Black", 
"Arab", 
"Any other ethnic group"))



#1: white 2: Asian 3: black 4: Arab 5: other


###################### Social grade per ethnicity##################
#clean data 
cen_rel <- select(census, marstat, caseno, hlqupuk11, scgpuk11c, religionew, ethnicityew)
cen_rel$separated <- cen_rel$marstat
cen_rel <- cen_rel %>% mutate(separated = replace(separated, marstat == 2 | marstat == 3, 0))
cen_rel <- cen_rel %>% mutate(separated = replace(separated, marstat == 5 | marstat == 4, 1))
colnames(cen_rel) <- c("ID", "marstat", "education", "social_grade", "religion", "ethnicity", "separated")
#replace -9 with NA 
cen_rel <- cen_rel %>% mutate_all(funs(replace(., . == -9, NA)))
cen_rel <- cen_rel %>% filter(!is.na(social_grade), !is.na(education), !(education == 16), !is.na(religion))

#, !(religion == "Not stated"))
dim(cen_rel)

#sort data
rel <- cen_rel %>% group_by(ethnicity, social_grade) %>% summarise(n = n(), separated = sum(separated), rel_div = (separated / n)*100) %>% mutate(sg = n/sum(n))

#plot education and social grade depending on religion

rp <- ggplot(rel, aes(x = factor(social_grade), y = rel_div))
rp + 
  geom_col(stat = "identity", position = "dodge") +
  scale_x_discrete(labels = c("10" = "none", "11" = "O levels / GCSE", "12" = "CSE / GCSE grade 1 / A", "13" = "apprenticeship", "14" = "A levels", "15" = "university degree")) +
  scale_y_continuous(limits = c(0, 50), breaks = seq(0, 50, 3)) +
  ggtitle("Divorce rate per ethnicity and social grade") +
  xlab ("Social grade") +
  ylab ("Divore rate in %") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  facet_wrap(~ ethnicity)

```

```{r}
#Divorce rate per education level per ethnicity

rel <- cen_rel %>% group_by(ethnicity, education) %>% summarise(n = n(), separated = sum(separated), rel_div = (separated / n)*100) %>% mutate(sg = n/sum(n))

#plot education and social grade depending on religion

rp <- ggplot(rel, aes(x = factor(education), y = rel_div))
rp + 
  geom_col(stat = "identity", position = "dodge") +
  scale_x_discrete(labels = c("10" = "none", "11" = "O levels / GCSE", "12" = "CSE / GCSE grade 1 / A", "13" = "apprenticeship", "14" = "A levels", "15" = "university degree")) +
  scale_y_continuous(limits = c(0, 50), breaks = seq(0, 50, 3)) +
  ggtitle("Divorce rate per ethnicity and education level") +
  xlab ("Education level") +
  ylab ("Divore rate in %") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  facet_wrap(~ ethnicity)


#1: white 2: Asian 3: black 4: Arab 5: other
```



```{r}
#Education per religion



#sort data
rel <- cen_rel %>% group_by(religion, education) %>% summarise(n = n(), separated = sum(separated), rel_div = (separated / n)*100) %>% mutate(sg = n/sum(n))

#plot education and social grade depending on religion

rp <- ggplot(rel, aes(x = factor(education), y = rel_div))
rp + 
  geom_col(stat = "identity", position = "dodge") +
  scale_x_discrete(labels = c("10" = "none", "11" = "O levels / GCSE", "12" = "CSE / GCSE grade 1 / A", "13" = "apprenticeship", "14" = "A levels", "15" = "university degree")) +
  scale_y_continuous(limits = c(0, 50), breaks = seq(0, 50, 3)) +
  ggtitle("Divorce rate per religion and education") +
  xlab ("Education level") +
  ylab ("Divore rate in %") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  facet_wrap(~ religion)
```


```{r}

rp <- ggplot(rel, aes(x = factor(education), y = rel_div))
rp + 
  geom_col(stat = "identity", position = "dodge") +
  scale_x_discrete(labels = c("10" = "none", "11" = "O levels / GCSE", "12" = "CSE / GCSE grade 1 / A", "13" = "apprenticeship", "14" = "A levels", "15" = "university degree")) +
  scale_y_continuous(limits = c(0, 50), breaks = seq(0, 50, 3)) +
  ggtitle("Divorce rate per education level") +
  xlab ("Education level") +
  ylab ("Divore rate in %") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  facet_wrap(~ religion)

```

in the different religions the pattern of the divorce rate per education level differe a lot from the overall pattern. Where there is on overall a high divorce rate for people with no education, for the  muslims it is way more constant, and for Buddhists it follow a totaly different pattern. 



```{r}
#divorce rate per social grade and religion

rel <- cen_rel %>% group_by(social_grade, religion) %>% summarise(n = n(), separated = sum(separated), rel_div = (separated / n)*100) 

rp <- ggplot(rel, aes(x = factor(social_grade), y = rel_div))
rp + 
  geom_col(stat = "identity", position = "dodge") +
  scale_y_continuous(limits = c(0, 50), breaks = seq(0, 50, 3)) +
  ggtitle("Divorce rate per social grade") +
  xlab ("Social grade") +
  ylab ("Divore rate in %") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  facet_wrap(~ religion)
```

```{r}
reli <- cen_rel %>% group_by(religion) %>% summarise(n = n(), separated = sum(separated), rel_div = (separated / n)*100) 


relp <- ggplot(reli, aes(x = religion, y = rel_div))
relp  +
  geom_col(fill  = "cadetblue3") +
  xlab("Religion") +
  ylab("Divorce rate in percent") +
  scale_y_continuous(limits = c(0, 40), breaks = seq(0, 40, 5)) +
  ggtitle("Divorce rate per religion")

```


```{r}
#education per religion (too small sample for less represented religions)
  
#sort data
rel <- cen_rel %>% group_by(religion, education, social_grade) %>% summarise(n = n(), separated = sum(separated), rel_div = (separated / n)*100) %>% mutate(sg = n/sum(n))

#plot education and social grade depending on religion

rp <- ggplot(rel, aes(x = factor(education), y = rel_div, fill = factor(social_grade)))
rp + 
  geom_col(stat = "identity", position = "dodge") +
  scale_x_discrete(labels = c("10" = "none", "11" = "O levels / GCSE", "12" = "CSE / GCSE grade 1 / A", "13" = "apprenticeship", "14" = "A levels", "15" = "university degree")) +
  scale_y_continuous(limits = c(0, 50), breaks = seq(0, 50, 3)) +
  ggtitle("Divorce rate per education level") +
  xlab ("Education level") +
  ylab ("Divore rate in %") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  facet_wrap(~ religion)
```



```{r}
#social grade and education
#divorce rate per social grade and education

region <- cen_r %>% group_by(education, social_grade) %>% summarise(n = n(), separated = sum(separated), rel_div = (separated / n)*100) %>% mutate(sg = n/sum(n))


rp <- ggplot(region, aes(x = factor(social_grade), y = rel_div))
rp + 
  geom_col(stat = "identity", position = "dodge") +
  scale_x_discrete(labels = c("10" = "none", "11" = "O levels / GCSE", "12" = "CSE / GCSE grade 1 / A", "13" = "apprenticeship", "14" = "A levels", "15" = "university degree")) +
  scale_y_continuous(limits = c(0, 45), breaks = seq(0, 45, 3)) +
  ggtitle("Divorce rate per education level and region") +
  xlab ("Education level") +
  ylab ("Divore rate in %") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  facet_wrap(~ education)
```



```{r}
#average white person christ 

#sort data
white <- cen_rel %>% filter(religion == "Christian", ethnicity ==1, social_grade == 4, education == 10) %>% summarise(n = n(), separated = sum(separated), rel_div = (separated / n)*100)

```


## Religion and Culture & Marriage
It cannot be denied that the cultural package each person has, is a major factor in his conception of marriage, his expectations toward a relationship and his values about divorce. Thus, in this part, we examine the factors of Ethnicity, Religion and Country of birth to try to determine the effect it has on divorce rate. 

These variables are distributed as the following pie charts show :

```{r, echo=FALSE, message = FALSE}
myowndata <- fd %>% select(marstat, binary_marstat, cobg, ethnicityew, religionew)

```

```{r, echo = FALSE}
# Factoring Data

myowndata[, 'cobg'] <- factor(myowndata[, 'cobg'], levels = seq(1,26), labels = c("England","Scotland", "Northern Ireland", "Wales", "United Kingdom not otherwise specified", "Ireland", "Germany", "Poland", "Other EU countries: Member countries in 2001", "Other EU countries: Accession countries 2001 to 2011", "Rest of Europe", "North Africa", "Central and Western Africa", "South and Eastern Africa", "Africa not otherwise specified", "Middle East", "Eastern Asia", "Southern Asia: Bangladesh", "Southern Asia: India", "Southern Asia: Pakistan", "Rest of Southern Asia", "South-East Asia", "Central Asia", "North America and the Caribbean", "Central and South America", "Antarctica, Oceania and other"))

myowndata[, 'binary_marstat'] <- factor(myowndata[, 'binary_marstat'], levels = c(1,0), labels = c("Separated/Divorced","Married/In a relationship"))

myowndata[, 'ethnicityew'] <- factor(myowndata[, 'ethnicityew'], levels = seq(1,18), labels = c("English/Welsh/Scottish/Northern Irish/British", "Irish", "Gypsy or Irish Traveller", "Other White", "Mixed/multiple ethnic group: White and Black Caribbean", "Mixed/multiple ethnic group: White and Black African", "Mixed/multiple ethnic group: White and Asian", "Mixed/multiple ethnic group: Other Mixed", "Indian", "Pakistani", "Bangladeshi", "Chinese", "Other Asian", "African", "Caribbean", "Other Black", "Arab", "Any other ethnic group"))

myowndata[, 'religionew'] <- factor(myowndata[, 'religionew'], levels = seq(1,9), labels = c("No religion", "Christian", "Buddhist", "Hindu", "Jewish", "Muslim", "Sikh", "Other religion", "Not stated"))

myowndata <- na.omit(myowndata)

myowndata$ethngrouped <- ifelse(myowndata$ethnicityew == "English/Welsh/Scottish/Northern Irish/British"  | myowndata$ethnicityew == "Irish" | myowndata$ethnicityew == "Gypsy or Irish Traveller"| myowndata$ethnicityew == "Other White", "White", 
                                ifelse( myowndata$ethnicityew == "Indian" | myowndata$ethnicityew == "Pakistani"| myowndata$ethnicityew == "Bangladeshi" | myowndata$ethnicityew == "Chinese"| myowndata$ethnicityew == "Other Asian", "Asian", 
                                        ifelse(myowndata$ethnicityew == "African" | myowndata$ethnicityew == "Caribbean"| myowndata$ethnicityew == "Other Black", "Black", 
                                               ifelse(myowndata$ethnicityew == "Arab", 'Arab', 
                                                      ifelse(myowndata$ethnicityew == "Any other ethnic group", "Any other", "Mix Group")))))

```

```{r, echo = FALSE, message=FALSE}

mydata_ethn <- myowndata %>% group_by(ethngrouped) %>% summarise(count = n()) 

lbls <- paste(mydata_ethn$ethngrouped, mydata_ethn$count) 
lbls <- paste(lbls,"%",sep="") 
pie(mydata_ethn$count, labels = mydata_ethn$ethngrouped, col=rainbow(length(lbls)), main="Pie chart of ethnicities")

mydata_relig <- myowndata %>% group_by(religionew) %>% summarise(count = n()) 

lbls2 <- paste(mydata_relig$religionew, mydata_relig$count) 
lbls2 <- paste(lbls,"%",sep="") 
pie(mydata_relig$count, labels = mydata_relig$religionew, col=rainbow(length(lbls2)), main="Pie chart of religions")
```


Our assumption is that divorce rate will be higher among white people who are generally considered having more liberal values, and permissive laws for divorce. We also expect that the less commited people are toward religion, the more they are likely to get divorced.


```{r, echo = FALSE}
# Correlation tests
#cor.test(filtered_data$religionew, filtered_data$binary_marstat)

#cor.test(filtered_data$ethnicityew, filtered_data$binary_marstat)

#cor.test(filtered_data$cobg, filtered_data$binary_marstat)
```



```{r, echo = FALSE, eval=FALSE}
# Chi-Square Test

chisq.test(myowndata$cobg, myowndata$binary_marstat)

chisq.test(myowndata$ethnicityew, myowndata$binary_marstat)

chisq.test(myowndata$religionew, myowndata$binary_marstat)
```

Basic correlation tests between the marital status and the different variables (religion, ethnicities, country of birth) indicate that there is a correlation (p-value < 5%). Our aim is to have more insight about it.

### Ethnicities

```{r, echo = FALSE, message=FALSE, warning=FALSE}
ethn <- myowndata %>% dplyr::select(binary_marstat, ethnicityew) %>% group_by(binary_marstat, ethnicityew) %>% summarise(count = length(binary_marstat)) %>% ungroup() %>% group_by(ethnicityew) %>% mutate(prop = count / sum(count))


ethn_divorced = filter(ethn, binary_marstat == "Separated/Divorced")
ethn_divorced <- ethn_divorced[order(ethn_divorced$prop),]


# Grouping ethnicities

ethn$ethngrouped <- ifelse(ethn$ethnicityew == "English/Welsh/Scottish/Northern Irish/British"  | ethn$ethnicityew == "Irish" | ethn$ethnicityew == "Gypsy or Irish Traveller"| ethn$ethnicityew == "Other White", "White", 
                                ifelse( ethn$ethnicityew == "Indian" | ethn$ethnicityew == "Pakistani"| ethn$ethnicityew == "Bangladeshi" | ethn$ethnicityew == "Chinese"| ethn$ethnicityew == "Other Asian", "Asian", 
                                        ifelse(ethn$ethnicityew == "African" | ethn$ethnicityew == "Caribbean"| ethn$ethnicityew == "Other Black", "Black", 
                                               ifelse(ethn$ethnicityew == "Arab", 'Arab', 
                                                      ifelse(ethn$ethnicityew == "Any other ethnic group", "Any other ethnic group", "Mix Group")))))






## Age & Marriage

Contains information about the age of the observation (person) in years. This variable ranges from 0 to 90 and is treated as a continuous variable. Ages 70, 75, 80, and 85 are clustered into groups each ranging 5 years (i.e. 70 through 74, 75 through 79, etc...). Furthermore, the 90 age group conatins ages 90 and above.

For the purposes of this analysis, and to calculate the divorce rate by age, the clustered age groups were equally distibuted among the number of ages the group contains. (e.g the 70 through 74 age group was divided into 5 seperate age groups 70, 71, 72, 73, and 74 each inherenting the parent group's divorce rate).

Exhibit 1: Density of un-modified age

The chart below, depicts the density distribution of ages in the dataset before any modifications were applied. As expected, instances of the observations' ages are relatively equal among the dataset, which should ensure a fair representation of all age groups.
```{r}
#need to add in original dataset to show density of original age distribution
ggplot(data = fd, aes(x = age)) + geom_density(fill = 'grey') + ylab("Density") + xlab("Age") + ggtitle("Density distribution of age")
```

Exhibit 2: Divorce rate by age:

The chart below shows the divorce rate (as defined in the introduction) for each of the 83 age groups (18 to 100). 

The divorce rate for observations aged 18, 19, and 20 is significantly higher than observations in their 20's. The rationale for this observation is the scarcity (nominally) of married people who are 20 and less, which results in a large relative proportion of divorced people when compared to other age groups. The high divorce rate among young people can also be explained by the often painful and troubelsome reality of marriage. 
https://www.theguardian.com/lifeandstyle/2014/dec/19/-sp-why-do-so-many-young-marriages-come-to-an-early-end

The age with the highest divorce rate in the dataset is 48. Likely causes of this statistic are people who got married earlier in their lives and got divorced for reasons stated above, and now belong to this age group, or the shift in societal norms where staying in an un-happy marriage is no longer neccessary and where online dating and other activities are so readily available. 
http://www.prince-evans.co.uk/2017/01/divorce-rate-highest-among-aged-40-49/

This is further suported by the fact that younger people are less likely to be divorced, as those would be early-on in their marriages,while older people have a greater chance of being being remarried and thus will once again be classified as married according to the classifications in the UK census data. Additionally, although divorce rates for people above the age of 53 (Baby Boomers) are rising, this class of society generally has traditional values and beleif systems that consider marriage to be the norm. This, therefore, supports the idea that the marginal rate of divorce decreases above the age of 48. https://www.theguardian.com/lifeandstyle/2013/aug/06/divorces-rise-over-60s
  

```{r}

data2 <-  filtered_data %>% filter(marstat == 2 | marstat == 3 | marstat == 4 | marstat == 5) %>% filter(age >= 18) %>% mutate(seperated = marstat) %>% mutate(seperated = replace(seperated, marstat!= 5 | marstat != 4, 0)) %>% mutate(seperated = replace(seperated, marstat == 5 | marstat == 4, 1))
#new dataframe containing the summarised count by age
total_group <- data2 %>% dplyr::select(age, seperated) %>% group_by(age) %>% summarise(count = n())
total_group_full <- total_group[1:52,]
dummy1 <- data.frame(age = 70:100)
dummy1$count <- rep(1,31)
dummy1$count[1:5] <- rep(round(total_group$count[53] / 5), 5)
dummy1$count[6:10] <- rep(round(total_group$count[54] / 5), 5)
dummy1$count[11:15] <- rep(round(total_group$count[55] / 5), 5)
dummy1$count[16:20] <- rep(round(total_group$count[56] / 5), 5)
dummy1$count[21:31] <- rep(round(total_group$count[57] / 11), 11)
new_total_group <- rbind.data.frame(total_group_full, dummy1)

#create a new sub-data frame from data2 grouped by age and seperated status and summarised 
divorced <-  data2 %>% dplyr::select(age, seperated) %>% filter(seperated == 1) %>% group_by(age, seperated) %>% summarise(n = n()) %>% ungroup() %>% group_by(seperated) %>% mutate(prop = n / sum(n) * 100)

#new divorced_full dataframe that contains all age groups above 70 i.e (70 to 100) since the orignal dataset groups ges above 70 by increments of 5. Count of divorced people was divided equally among the five tranches
divorced_full <- divorced[1:52,]
dummy <- data.frame(age = 70:100)
dummy$seperated <- rep(1,31)
dummy$n <- rep(1,31)
dummy$prop <- rep(1,31)
dummy$n[1:5] <- rep(divorced$n[53] / 5, 5)
dummy$prop[1:5] <- rep(divorced$prop[53] / 5, 5)
dummy$n[6:10] <- rep(divorced$n[54] / 5, 5)
dummy$prop[6:10] <- rep(divorced$prop[54] / 5, 5)
dummy$n[11:15] <- rep(divorced$n[55] / 5, 5)
dummy$prop[11:15] <- rep(divorced$prop[55] / 5, 5)
dummy$n[16:20] <- rep(divorced$n[56] / 5, 5)
dummy$prop[16:20] <- rep(divorced$prop[56] / 5, 5)
dummy$n[21:31] <- rep(divorced$n[57] / 11, 11)
dummy$prop[21:31] <- rep(divorced$prop[57] / 11, 11)
new_divorced <- rbind.data.frame(divorced_full, dummy)

#create new data.frame to calculate the divorce rate per age. This is done by dividing the count of divorced people from divorced data frame by the respective rows from the total group data frame 
divorce_by_age <- data.frame(prop = c(1:83), age = new_divorced$age)
divorce_by_age$prop <- rep(1, 83)
divorce_by_age$prop <- new_divorced$n / new_total_group$count * 100

ggplot(data = divorce_by_age, aes(x = age, y = prop)) + geom_line() + ylab("Divorce rate (%)") + xlab("Age") + ggtitle("Divorce rate by age")
```

Exhibit 3: Proportion of divorced people by age

The chart above shows the proportion of divorced people for each age group. The chart shows a curve resembling a normal distribution.
```{r}
ggplot(data = new_divorced, aes(x = age, y = prop)) + geom_line() + ylab("Divorce rate (%)") + xlab("Age") + ggtitle("Proportion of divorced people by age")
```

Exhibit 5: Divorce rate by age and social grade

The following chart depicts the distribution of divorce rate by age per level of social class.
From the data, it is apparent that the trend observed in the overall sample can also be observed when examining social classes, the divorce rate trends upwards from the lower ages and peaks in the late 40's, this trend then reverses with the divorce rate decreasing with age.

It may be worth noting that while the general trend is consistent accross social classes, one inconsistency does seem to appear in the 18 age group. The people aged 18 in the "AB" social class have a much lower divorce rate of around 8% than the other social classes at more than 20%. This seems to suggest that at young ages, affluence and wealth might potentially provide a cushion for a married couple and alleviate the stresses of financial troubles, which play a big role in divorce.

These findings provide support the notion that divorce rate distibution by age seems to behave similarly regardless of other variables. Further analysis may be required to assess the validity of this claim accross different variables.



```{r}
#creating a new dataframe grouped by age social grade and divorced status
data4 <- data2 %>% dplyr::select(age, scgpuk11c, seperated) %>% filter(scgpuk11c != -9) %>% filter(seperated == 1) %>% group_by(age, scgpuk11c, seperated) %>% summarise(n = n())
data4_control <- data2 %>% dplyr::select(age, scgpuk11c) %>% filter(scgpuk11c != -9) %>% group_by(age, scgpuk11c) %>% summarise(n = n())
data4$divorce_rate <- data4$n / data4_control$n * 100
data4$scgpuk11c <- factor(data4$scgpuk11c, levels = c(1,2,3,4), labels = c("AB", "C1", "C2", "DE"))
ggplot(data = data4, aes(x = age, y = divorce_rate)) + geom_col(position = 'dodge', colour = 'red') + facet_wrap(~ scgpuk11c) + ylab("Divorce rate (%)") + xlab("Age") + ggtitle("Divorce rate distibution by age per social grade")

```



## Region/Geography & Marriage
An article on divorce rate by region piqued our interests (http://www.dailymail.co.uk/news/article-3201497/Wish-weren-t-ten-divorce-hot-spots-Britain-sea-Blackpool-worst-place-live-want-happy-marriage.html). It lists the top 10 divorce hot spots and they are all coastal cities. The article states that the factors contributing to the high divorce rate in coastal regions are due to the high deprivation and possibly sheer boredoem in winter. In this paper we are keen to explore whether our data attests to the findings of that article. 


Our plot shows a significant peak in the percentage of people in bad marriage (either divorced or separated) in Inner London compared to elsewhere. This is the opposite to the aforementioned article. London is anything but a deprived and boring city. The hypothesis testing conducted further confirms that region and marital status are not independent, and particularly Inner London has a higher divorce rate than elsewhere. Inner London has a divorce rate of approximately 25.4%, higher than the average of 19.9% in UK. The difference is statistically significant. Our focus then shifts to explore the factors that are causing such high divorce rates in London. 


```{r, echo = FALSE}
# select the data relevant for region
region1 <- dplyr:: select(fd, binary_marstat, age, aggdtwpew11g, region, marstat, transport, wpzhome, Highest_qualification, binary_region_factor, binary_region_num,hours, tenure)

region_count<- region1 %>% select(marstat, region) %>% group_by(region, marstat)%>% summarise(count = n())%>% tidyr::spread(key = marstat, value = count) %>% mutate(divorce_rate = (Divorced + Separated)/(Divorced + Married + Separated))

```

```{r region_plot, fig.width=3,fig.height=3}
# plot divorce rate for region
region1%>% group_by(region) %>% summarise(divorce_rate = mean(binary_marstat))%>% ggplot(aes(x = region, y = divorce_rate*100))+ geom_col() + theme(axis.text.x = element_text(angle = 30, hjust = 1)) + labs( title = "Divorce rate by region", x = 'Region', y = 'Divorce rate (%)')
```

```{r, echo = FALSE, eval = FALSE}
# chi-squared test
region_test <- region_count[,-1]
rownames(region_test) <- as.data.frame(region_count)[,1]
chi_region <- chisq.test(as.data.frame(region_test))
chi_region
round(chi_region$residuals, 3)
```


```{r region_ttest, echo = FALSE, eval=FALSE}

t.test(fd$binary_marstat, fd$binary_marstat[fd$region == "Inner London"])
```

```{r, echo = FALSE, eval = FALSE}
#mean_London <- fdata$binary_marstat[fdata$region == "Inner London"]
outside_london <- fd$binary_marstat[fd$region != "Inner London"]

t.test(outside_london, fd$binary_marstat[fd$region == "North East"])
t.test(outside_london, fd$binary_marstat[fd$region == "North West"])
t.test(outside_london, fd$binary_marstat[fd$region == "Yorkshire and the Humber"])
t.test(outside_london, fd$binary_marstat[fd$region == "East Midlands"])
t.test(outside_london, fd$binary_marstat[fd$region == "West Midlands"])
t.test(outside_london, fd$binary_marstat[fd$region == "East of England"])
t.test(outside_london, fd$binary_marstat[fd$region == "Outer London"])
t.test(outside_london, fd$binary_marstat[fd$region == "South East"])
t.test(outside_london, fd$binary_marstat[fd$region == "South West"])
t.test(outside_london, fd$binary_marstat[fd$region == "Wales"])

```

Could the region people choose to live affect their marriage satisfaction, or is it merely an artifact as a result of other influencing factors? We plot the divorce rates against other variables in our list and wrap them by region. If the variables have no impact, we should observe the same pattern across all regions, with London having a slightly higher divorce rate. 

After looking at the relationship between divorce rate and education, social grade, hours worked per week, ethnicity, religion, housing type, number of children in the household, we found no difference in patterns between Inner London and the rest. 

Interestingly we observe a significantly high divorce rate for people aged 50 and above in Inner London. We further break down the population into two groups: age below 50 and age 50 and above. In the first group we no longer see any significant difference in divorce rates across regions, but the difference becomes more apparent in the second group (19.6% for population and 32.8% for aged 50 and above living in Inner London) and is statistically significant. 

We have two questions following this observation, firstly why are there so many people getting divorced after 50s and secondly why Inner London?

According to Office for National Statistics in their online publication in July 2017, while the number of divorces drop by 28% from 2005 to 2015, the number of men divorcing aged above 65 went up by 23% and 38% for women. Various factors contribute to the increasing divorce rate among older people (Susan L. Brown and I-Fen Lin 18 Oct 2012). People getting more open-minded and receptive to divorce around them, higher economic independence, and more social interactions with people are among them. More significantly observed in their data is that people in higher order marriages are more likely to end up in divorces than people in first marriage (53.46% compared to 46.54%). And people in their 50s and 60s are also more likely to be in higher order marriages compared to younger people. Unfortunately information on order of marriages is abcent in our data. 

There is no empirical study on divorce rates in different regions in UK, but we think the reasons mentioned above could all have contributed to the high divorce rates in Inner London. However we must be careful not to confuse the status of being divorced or separated with the instance of getting a divorce. In our data we look at the percentage of people who are divorced or separated at the time of the survey, without information on when and where the divorce occured. It could also be possible that people in Inner London are less likely to remarry after they are divorced, just like London has the highest percentage of singles aged 30 and above. London is fun and people could be just having a good time being single or in relationships, without rushing into any marriage. We can conclude that there are more divorce and separated people living in London but not infer any causal relationship. Above all, London is the number one Tinder hotspots (thrillist.com, Nov 2015). 




According to Office for National Statistics in their online publication in July 2017, while the number of divorces drop by 28% from 2005 to 2015, the number of men divorcing aged above 65 went up by 23% and 38% for women. Various factors contribute to the increasing divorce rate among older people (Susan L. Brown and I-Fen Lin 18 Oct 2012). People getting more open-minded and receptive to divorce around them, higher economic independence, and more social interactions with people are among them. More significanty observed in their data is that people in higher order marriages are more likely to end up in divorces than people in first marriage (53.46% compared to 46.54%). And people in their 50s and 60s are also more likely to be in higher order marriages compared to younger people. Unfortunately information on order of marriages is abcent in our data. 

There is no empirical study on divorce rates in different regions in UK, but we think the reasons mentioned above could all have contributed to the high divorce rates in Inner London. However we must be careful not to confuse the status of being divorced or separated with the instance of getting a divorce. In our data we look at the percentage of people who are divorced or separated at the time of the survey, without information on when and where the divorce occured. It could also be possible that people in Inner London are less likely to remarry after they are divorced, just like London has the highest percentage of singles aged 30 and above. London is fun and people could be just having a good time being single or in relationships, without rushing into any marriage. We can conclude that there are more divorce and separated people living in London but not infer any causal relationship. Above all, London is the number one Tinder hotspots (thrillist.com, Nov 2015). 


There is no empirical study on divorce rates in different regions in UK, we must be careful not to confuse the status of being divorced or separated with the instance of getting a divorce. In our data we look at the percentage of people who are divorced or separated at the time of the survey, without information on when and where the divorce occured. It could also be possible that people in inner London are less likely to remarry after they are divorced, just like London has the highest percentage of singles aged 30 and above. London is fun and people could be just having a good time being single or in relationships, without rushing into any marriage. We can conclude that there are more divorce and separated people living in London but not infer any causal relationship. Above all, London is the number one Tinder hotspots. 



```{r region_vs_others, echo = FALSE, eval= FALSE}
# divorce rate by variables and wrapped by region

#divorce rate by age 
fd %>% group_by(region, age) %>% summarise(divorce_rate = mean(binary_marstat))%>% ggplot(aes(x = age, y = divorce_rate))+ geom_col() + facet_wrap(~region)

#divorce rate by children_class
fd %>% filter(!is.na(children_class))%>% group_by(region, children_class) %>% summarise(divorce_rate = mean(binary_marstat))%>% ggplot(aes(x = children_class, y = divorce_rate))+ geom_col() + facet_wrap(~region)+ theme(axis.text.x = element_text(angle = 60, hjust = 1))  

#divorce rate by Highest_qualification
fd %>% filter(!is.na(Highest_qualification) & Highest_qualification != 'Others') %>%group_by(region, Highest_qualification) %>% summarise(divorce_rate = mean(binary_marstat))%>% ggplot(aes(x = Highest_qualification, y = divorce_rate))+ geom_col() + facet_wrap(~region)+ theme(axis.text.x = element_text(angle = 60, hjust = 1)) 

#divorce rate by hours worked
fd %>% filter(!is.na(hours)) %>%group_by(region, hours) %>% summarise(divorce_rate = mean(binary_marstat))%>% ggplot(aes(x = hours, y = divorce_rate))+ geom_col() + facet_wrap(~region)+ theme(axis.text.x = element_text(angle = 60, hjust = 1))  

#divorce rate by ethnicity
fd %>% filter(!is.na(ethnicityew)) %>%group_by(region, ethnicityew) %>% summarise(divorce_rate = mean(binary_marstat))%>% ggplot(aes(x = ethnicityew, y = divorce_rate))+ geom_col() + facet_wrap(~region)+ theme(axis.text.x = element_text(angle = 60, hjust = 1))  

#divorce rate by religion
fd %>% filter(!is.na(religionew)) %>%group_by(region, religionew) %>% summarise(divorce_rate = mean(binary_marstat))%>% ggplot(aes(x = religionew, y = divorce_rate))+ geom_col() + facet_wrap(~region)+ theme(axis.text.x = element_text(angle = 60, hjust = 1))  

#divorce rate by tenure
fd %>% filter(!is.na(tenure)) %>%group_by(region, tenure) %>% summarise(divorce_rate = mean(binary_marstat))%>% ggplot(aes(x = region, y = divorce_rate))+ geom_col() + facet_wrap(~tenure)+ theme(axis.text.x = element_text(angle = 60, hjust = 1)) 

#divorce rate by distance to work
fd %>% filter(!is.na(wpzhome)) %>%group_by(region, wpzhome) %>% summarise(divorce_rate = mean(binary_marstat))%>% ggplot(aes(x = wpzhome, y = divorce_rate))+ geom_col() + facet_wrap(~region)+ theme(axis.text.x = element_text(angle = 60, hjust = 1))  

```

```{r region_graph_2agegroup}
#divorce rate by region for aged below 50
plot49 <- region1%>% filter(age <50) %>% group_by(region) %>% summarise(divorce_rate = mean(binary_marstat))%>% ggplot(aes(x = region, y = divorce_rate))+ geom_col() + theme(axis.text.x = element_text(angle = 30, hjust = 1)) + labs( title = "Divorce rate by region (aged below 50)", x = 'Region', y = 'Divorce rate (%)')

#divorce rate by region for aged 50 and above
plot50 <- region1%>% filter(age >=50) %>% group_by(region) %>% summarise(divorce_rate = mean(binary_marstat))%>% ggplot(aes(x = region, y = divorce_rate))+ geom_col() + theme(axis.text.x = element_text(angle = 30, hjust = 1)) + labs( title = "Divorce rate by region (aged 50 and above)", x = 'Region', y = 'Divorce rate (%)')

require(gridExtra)
grid.arrange(plot49, plot50, ncol=2)

```

```{r, echo = FALSE, eval = FALSE}
#t-test for difference in divorce rate in people aged above 50 across regions 
above50 <- filter(fd, age >= 50)
t.test(above50$binary_marstat, above50$binary_marstat[above50$region == "Inner London"])


# divorce rate by age and wrapped by regions
fd %>% group_by(region, age) %>% summarise(divorce_rate = mean(binary_marstat))%>% ggplot(aes(x = age, y = divorce_rate * 100))+ geom_col() + facet_wrap(~region) + labs( title = "Divorce rate by region", x = 'Region', y = 'Divorce rate (%)')


#distribution of age wrapped by region
fd %>% filter(!is.na(age))%>% ggplot(aes(x = age))+ geom_histogram() + facet_wrap(~region)

```

```{r, echo = FALSE, eval = FALSE}
#t-test for difference in divorce rate in people aged above 50 across regions 
above50 <- filter(fd, age >= 50)
t.test(above50$binary_marstat, above50$binary_marstat[above50$region == "Inner London"])


# divorce rate by age and wrapped by regions
fd %>% group_by(region, age) %>% summarise(divorce_rate = mean(binary_marstat))%>% ggplot(aes(x = age, y = divorce_rate * 100))+ geom_col() + facet_wrap(~region) + labs( title = "Divorce rate by region", x = 'Region', y = 'Divorce rate (%)')


#distribution of age wrapped by region
fd %>% filter(!is.na(age))%>% ggplot(aes(x = age))+ geom_histogram() + facet_wrap(~region)


```

### Dependent children

When people get married they are often in love and happy, most married couples look forward to parenthood and having children could even strengthen their marital bond. However empirical study shows that the effect of children on marital stability could be very complex. The greater number of children, the smaller possibility of divorce, but the relationship is inversely quadratic rather than linear suggesting the stabilizing effect is the strongest with the first and second child (Xu, Yu and Qiu 2015). The birth of an infant often brings couples back together who would have otherwise divorced. Most researches agree that children increase marital stability, however some say only when they are preschool-aged (Becker et al. 1977), as they grow older, their binding force in a marriage weakens. Experiencing divorce often place young children at risk for a variety of problems, which may persist into adulthood (Morrisox and Coiro, 1999). Therefore married couples may choose to stay in marriges for the wellbeing of their children but when children are old enough they decide to part their ways. 


We are keen to explore if we observe the same pattern in our data (1) the more children a couple have, the less likely they are to be divorced/separated. (2) as the age of youngest child grows, the more likely the couple will get divorced/separated 


Our graph shows that the divorce rate is higher when the couple has only one child (18.5%) than having no child (10.3%), but the divorce rates decreases as they have more children (11.6% for two children and 12.7% for three and more). Testing further confirms that the difference between one child and having no child is statistically significant, which is contradictory to earlier research showing that having even the first child increases marital stability. Could children give rise to parenting conflicts that lead to divorce and separation? Possible but we have no means to confirm. However our result could be screwed by the class NA data. The dataset has one class under the family dependent children variable named "Persons not in a family OR persons in other related families" and they have the highest divorce rate of 81%. These people could either have no children or regard them as having no children and if we consider them as no children, the pattern again is consistent with previous findings that children increase marital stability. We can confirm that the first hypothesis is true. 

When we look at the age of the youngest children in each class of number of children, the divorce rate increases as the children grow older which confirms our second hypothesis. 

```{r}
plot_number <- fd %>% select(dpcfamuk11, binary_marstat, tenure, scgpuk11c, binary_region_factor, children_class) %>% filter(!is.na(children_class)) %>% group_by(children_class)%>% summarise(divorce_rate = mean(binary_marstat))%>%ggplot(aes(x = children_class, y = divorce_rate))+ geom_col(position = 'dodge') + theme(axis.text.x = element_text(angle = 60, hjust = 1)) + labs(x = 'Number of children in family')

plotNA <- fd %>% select(dpcfamuk11, binary_marstat, tenure, scgpuk11c, binary_region_factor, children_class) %>% group_by(children_class)%>% summarise(divorce_rate = mean(binary_marstat))%>%ggplot(aes(x = children_class, y = divorce_rate))+ geom_col(position = 'dodge') + theme(axis.text.x = element_text(angle = 60, hjust = 1)) + labs(x = 'Number of children in family')

plot_age1 <- fd %>% select(dpcfamuk11, binary_marstat, tenure, scgpuk11c, binary_region_factor, children_class, youngest_child_age) %>% filter(!is.na(children_class)) %>% group_by(youngest_child_age)%>% summarise(divorce_rate = mean(binary_marstat))%>%ggplot(aes(x = youngest_child_age, y = divorce_rate))+ geom_col(position = 'dodge') + theme(axis.text.x = element_text(angle = 60, hjust = 1)) + labs(x = 'Youngest child age in family')


plot_age_number <- fd %>% select(dpcfamuk11, binary_marstat, tenure, scgpuk11c, binary_region_factor, children_class, youngest_child_age) %>% filter(!is.na(children_class)) %>% group_by(children_class, youngest_child_age)%>% summarise(divorce_rate = mean(binary_marstat))%>%ggplot(aes(x = youngest_child_age, y = divorce_rate))+ geom_col(position = 'dodge') + facet_wrap(~children_class)+ theme(axis.text.x = element_text(angle = 60, hjust = 1)) + labs(x = 'Youngest child age in family by number of children')


#grid.arrange(plo, plot_age, =2)

## Dependent Children and Social Grade


plot_social <- fd %>% select(binary_marstat, tenure, scgpuk11c, binary_region_factor, children_class) %>% filter(scgpuk11c != -9) %>% filter(!is.na(children_class)) %>% group_by(scgpuk11c, children_class)%>% summarise(divorce_rate = mean(binary_marstat))%>%ggplot(aes(x = scgpuk11c, y = divorce_rate, fill = children_class))+ geom_col(position = 'dodge') + theme(axis.text.x = element_text(angle = 60, hjust = 1)) + labs(x = 'Social Class')

#plot_number
#plot_social
#plotNA
grid.arrange(plot_number, plotNA, ncol=2)
plot_age1
#grid.arrange(plot_age1, plot_age, ncol = 2)
```

```{r number_children_ttest}
t.test(fd$binary_marstat[fd$children_class == '0.No children'], fd$binary_marstat[fd$children_class == "1.One child"])
```


# Health & Marriage

```{r message = FALSE, warning = FALSE, echo = FALSE}
mine <- select(fd, disability, marstat, binary_marstat)

mine$disability <- factor(mine$disability, levels = c(1,2,3), labels = c("Limit a lot", "Limit a little", "Not limited") )
mine$binary_marstat <- factor(mine$binary_marstat, levels = c(0,1), labels = c("married", "divorced"))
mine2 <- select(fd, disability, marstat, binary_marstat, scgpuk11c)
mine2 <- mine2[mine2$scgpuk11c != -9,]
mine2$disability <- factor(mine2$disability, levels = c(1,2,3), labels = c("Limit a lot", "Limit a little", "not limited") )
mine2 <- mine2 %>% group_by(disability,scgpuk11c) %>% mutate(divorce_rate = mean(binary_marstat))
mine2 <- mine2[complete.cases(mine2),]

mine3 <- mine2 %>% group_by(disability) %>% summarise(divorce_rate = mean(binary_marstat))
```

Since health is a critical factor for a satisfied life, health can be an important factor to influence marriage. There are three levels of health indicators in this dataset: "Limit a lot", "Limit a little", and "Not limited". Each level represents the degree of daily activities a person is limited to because of his or her long-term illness. The "Not limited" category indicates that a person's day to day activities are not limited at all by the long-term health illness or there is no illness. The percentage of the people falls under the category is 8.5%, 9.4%, and 82.1% for "Limit a Lot", "Limit a little", and "Not limited" respectively. 

```{r echo = FALSE}
chisq.test(mine$binary_marstat,mine$disability)
```

First of all, it is important to examine whether the health and marital status are independent of each other. The chi-square test indicates that there is a relationship between the two variables. The degree of the relationship is examined through Exhibit1 below. 

```{r echo = FALSE}

ggplot(mine3, aes(disability, divorce_rate))+geom_bar(stat = "identity")+labs(x = "Health", y = "Divorce Rate")
```

Exhibit 1 Health and Divorce Rate

Exhibit 1 illustrates how health has an observable impact on divorce rate. The divorce rate for "Not limited" people is 19.53%, which is 16.77% lower than the divorce rate of 36.30% for "Limit a lot" people. However, there is a chance that this model is highly correlated with other variables such as social status and may not be the real drive for this observable impact. It is possible that the people with lower social status is not able to afford healthcare or healthy lifestyle and therefore lead to higher divorce rate.


```{r echo = FALSE}
ggplot(mine2, aes(factor(scgpuk11c), divorce_rate, fill = disability))+geom_bar(stat = "identity", position = "dodge") + labs(x = "Social Grade", y = "Divorce Rate")
```

Exhibit 2 Controling the Social Grade

To validate this finding, it is important to examine the colinearity between social grade and health. According to Exhibit 2, within each social grade, the impact of disability on health is still very strong and especially strong in the lowest social grade, level 4.Therefore, it can be concluded that the variable health has a real and observable impact on marital status. The more severe the health problem, the higher the divorce rate. 

Furthermore, similar findings are also published elsewhere. A report by Time (http://time.com/83486/divorce-is-more-likely-if-the-wife-not-the-husband-gets-sick/) dicussed that 75% of couples dealing with chronic disease end in divorce. To summarise, health problems indeed significantly influence the divorce rate. 



# Logistic Regression
##A comprehensive regression analysis of all correlated variables

###Method
As the dependant variable in question is a dichotomous variable (divorced or not divorced), we chose to build a logistic regression model instead of a linear regression model. Then we selected the variables discussed above as dependent variables. The variables presented thus far in this report are the variables hypothesised to have the greatest effect on a person's liklihood of being divorced in the sample.  Our goal was to use the variables we examined to predict whether a person will be divorced. 

Overall, we experimented with a total of 8 variables to find the best Logistic Regression Model:
1. Social Grade
2. Education
3. Age
4. Religion
5. Health
6. Number of Children
7. Ethnicity
8. Whether the person lives in London

The best fit was determined by adding and removing the variables above until the best combination of the aforementioned metrics was obtained.

As a measure of the overall model's explanatory power, two main measures were use:
1) c-statistic or AUC (area under ROC curve)
2) The accuracy of the predictions above a certain threshold (the mean divorce rate for our purposes)

In addition, we also examined the multicolinearity of our model to ensure its validity. In order to understand how good our model is, we partitioned the original dataset into 70% training data and 30% test data. After we used the training data to train the model, we then used the test data to compare our models.


```{r echo = FALSE}

census$ethnicityew <- factor(census$ethnicityew, levels = seq(1,18), labels = c("English/Welsh/Scottish/Northern Irish/British", 
"Irish", 
"Gypsy or Irish Traveller", 
"Other White", 
"Mixed/multiple ethnic group: White and Black Caribbean", 
"Mixed/multiple ethnic group: White and Black African", 
"Mixed/multiple ethnic group: White and Asian", 
"Mixed/multiple ethnic group: Other Mixed", 
"Indian", 
"Pakistani", 
"Bangladeshi", 
"Chinese", 
"Other Asian", 
"African", 
"Caribbean", 
"Other Black", 
"Arab", 
"Any other ethnic group"))

#1: white 2: Asian 3: black 4: Arab 5: other
census$ethngrouped <- census$ethnicityew
census$ethngrouped <- ifelse(census$ethnicityew == "English/Welsh/Scottish/Northern Irish/British"  | census$ethnicityew == "Irish" | census$ethnicityew == "Gypsy or Irish Traveller"| census$ethnicityew == "Other White", 1,       ifelse( census$ethnicityew == "Indian" | census$ethnicityew == "Pakistani"| census$ethnicityew == "Bangladeshi" | census$ethnicityew == "Chinese"| census$ethnicityew == "Other Asian", 2, 
                                        ifelse(census$ethnicityew == "African" | census$ethnicityew == "Caribbean"| census$ethnicityew == "Other Black", 3, 
                                               ifelse(census$ethnicityew == "Arab", 4, 
                                                      ifelse(census$ethnicityew == "other", "Any other ethnic group", 5)))))

```


```{r echo = FALSE, warning= FALSE}
lr <- select(census, caseno, disability, marstat, hlqupuk11, scgpuk11c, religionew, age, region)
lr$separated <- lr$marstat
lr <- lr %>% mutate(separated = replace(separated, marstat == 2 | marstat == 3, 0))
lr <- lr %>% mutate(separated = replace(separated, marstat == 5 | marstat == 4, 1))
lr <- lr %>% mutate(london = ifelse(region == 10, 1, 0))
colnames(lr) <- c("ID", "disability", "marstat", "education", "social_grade", "religion", "age", "region", "separated", "london")
#replace -9 with NA 
lr <- lr %>% mutate_all(funs(replace(., . == -9, NA)))
lr <- lr %>% filter(!is.na(social_grade), !is.na(education), !(education == 16), !is.na(religion))

```

```{r echo = FALSE}
# Create training and validation dataset
input_ones <- lr[which(lr$separated == 1), ]  # all 1's
input_zeros <- lr[which(lr$separated == 0), ]  # all 0's
set.seed(100)  # for repeatability of samples
input_ones_training_rows <- sample(1:nrow(input_ones), 0.7*nrow(input_ones))  # 1's for training
input_zeros_training_rows <- sample(1:nrow(input_zeros), 0.7*nrow(input_zeros))  # 0's for training. Pick as many 0's as 1's
training_ones <- input_ones[input_ones_training_rows, ]  
training_zeros <- input_zeros[input_zeros_training_rows, ]
trainingData <- rbind(training_ones, training_zeros)  # row bind the 1's and 0's 

# Create Test Data
test_ones <- input_ones[-input_ones_training_rows, ]
test_zeros <- input_zeros[-input_zeros_training_rows, ]
testData <- rbind(test_ones, test_zeros)  # row bind the 1's and 0's 
```


```{r message = FALSE, echo = FALSE, results = "hide", warning = FALSE}

library(smbinning)
library(InformationValue)

# use training data to train the model
#lin_mo1 <- glm(separated ~ social_grade + education + religion + age + london + children + ethnicity, data = trainingData, family = binomial)
#lin_mo2 <- glm(separated ~ social_grade + education + religion + age + london + disability + children +ethnicity, data = trainingData, family = binomial)
lin_mo1 <- glm(separated ~ social_grade + education, data = trainingData, family = binomial)
lin_mo2 <- glm(separated ~ social_grade + education + age, data = trainingData, family = binomial)

lin_mo3 <- glm(separated ~ social_grade + education + disability, data = trainingData, family = binomial(link = "logit"))
lin_mo4 <- glm(separated ~ social_grade + education + disability + age, data = trainingData, family = binomial(link = "logit"))
lin_mo5 <- glm(separated ~ social_grade, data = trainingData, family = binomial(link = "logit"))


# create predicted values and un-log it.
predicted1 <- predict(lin_mo1, testData, type = "response")
predicted2 <- plogis(predict(lin_mo2, testData))
predicted3 <- plogis(predict(lin_mo3, testData))
predicted4 <- plogis(predict(lin_mo4, testData))
predicted5 <- predict(lin_mo5, testData, type = "response")

# check for misclassification error
#misClassError(testData$separated, predicted1)
# 0.4311, It should be a value between 0 and 1, the lower the better
#misClassError(testData$separated, predicted2)
#misClassError(testData$separated, predicted3, threshold = Cutoff)
#misClassError(testData$separated, predicted4)
#misClassError(testData$separated, predicted5)


#plotROC(testData$separated, predicted5)
#plotROC(testData$separated, predicted4)
#plotROC(testData$separated, predicted3)
#plotROC(testData$separated, predicted2)
#plotROC(testData$separated, predicted1)

#library(stargazer)
#stargazer(list(lin_mo1,lin_mo2, lin_mo3),type = "text")
```
Based on our analysis, the best model contains 4 variables: Social Grade, Education, Health, and Age. 

### ROC Curve
A close look on the ROC Curve can give us more insights. Shown by the sensitivity and 1-specifity index, the increase of the True positive Rate of our model is slightly faster than the increase of the false positive rate. Since the greater the AUC (Area Under the Curve) the better the predictive ability of the model, the AUC of our model 0.6105 indicates that our model is fair but not perfect. 
```{r echo = FALSE}
lin_mo4 <- glm(separated ~ social_grade + education + disability + age , data = trainingData, family = binomial(link = "logit"))
predicted4 <- plogis(predict(lin_mo4, testData))
#misClassError(testData$separated, predicted4)
plotROC(testData$separated, predicted4)
```


### Accuracy
Next, we calculate the model's accuracy by comparing it to the mean of the test dataset. The result indicates that the accuracy rate is 58.89%. The accuracy rate tells us how accurate our predicted result compared to the actual result is. Our model will get about 59 correct results within 100 examples. 

```{r}
# Calculate the model's accuracy
pred <- ifelse(predicted4 > mean(as.numeric(testData$separated)), 1, 0)
mean(testData$separated == pred)
```

### Multicollinearity
Finally, we examined the multicollinearity in the model by using the Variance Inflation Factor. According to the result below, all indicators are very close to 1 and well below 5. Therefore, all predictors within this particular logistic regression are not linearly related. We can safely conclude that the multicollinearity is very low and the model is valid.

```{r echo = FALSE, warning = FALSE, message = FALSE}
# check for multicollinearity
library(car)
vif(lin_mo4) 
# as long as all values are below 4, it is fine, no big deal
```

### Limitation
Unfortunately, we recognize that our model does not outperform the base prediction because the mean divorce rate is about 21%. This means that if we predict all people are not divorced, we will yield a higher prediction result. We suspect that this result is a problem rooted in the original massive census dataset because there are a total of 121 variables, and we are likely to miss some potential drivers of the marital status.

### Conclusion
Nevertheless, our finding is still significant because we identified a few strong drivers to unhappy marriages. Among all variables we dicussed in this report, Social Grade, Education, Age, and Health are the most important factors for predicting if a person is likely to be divorced.  





# Conclusion

This paper has examined variables hypothesised to affect divorce rates in the UK. According to the analysis performed above, it is evident that divorce rates have multiple determinant factors, which themselves are potentially co-dependant. This analysis does not attempt to single out a specific variable or group of variables as the main determinant of divorce rate, but examines potential affecting variables.

Lacking any information about a particular person, age would be a good first predictor of marital status. It has been shown that people in their 40's have the highest divorce rates in society. This is true regardless of social status.

It is evident that social class and education level are amongst the biggest influencing factors of divorce rate as depicted by the strong inverse relationship of these variables with divorce rates. This trend holds true accross all ethnicities and religions, which further suppports the strength of the variables.


# References

Main Github Repository: https://github.com/dlouhasha/TheGreatWork

Adam Isen, Betsey Stevenson (2010). Women's Education and Family Behavior: Trends in Marriage, Divorce and Fertility. *Nber Working Paper Series*, No.15725. Available from: [DOI: 10.3386/w15725] (Accessed on 11 October 2017)

Alexander Hagelken, Suddeutsche Zeitung (2014) *Heiraten zementiert soziale Spaltung*, Available from: [http://www.sueddeutsche.de/wirtschaft/partnerwahl-und-ungleichheit-heiraten-zementiert-soziale-spaltung-1.1875581] (Accessed on 12 October 2017)

Anushka Asthana and Denis Campbell, The Guardian (2009) *US study says divorce is linked to age and education*. Available from: [https://www.theguardian.com/lifeandstyle/2009/sep/27/divorce-linked-to-age-education] (Accessed on 11 October 2017)

Becker, Gary S., Elizabeth Landes, and Robert T. Michael (1977) An Economic Analysis of Marital Instability. *Journal of Political Economy*, 85:1141-87. 

Donna Ruane Morrisox and Mary Jo Coiro, Parental Conflict and Marital Disruption: Do Children Benefit When High-Conflict Marriages Are Dissolved?. Journal of Marriage and the Family 6 1 (August 1999): 626-637

Chloe Pantazi, Thrillist (2015) *Where are the Tinder users trying to get laid the most?*. Available from:[thttps://www.thrillist.com/travel/nation/where-tinder-passport-users-are-swiping-the-most] (Accessed on 12 October 2017)

Donna Ruane Morrisox and Mary Jo Coiro (1999) Parental Conflict and Marital Disruption: Do Children Benefit When High-Conflict Marriages Are Dissolved?. *Journal of Marriage and the Family* 6(1), 626-637

Hlavac, Marek (2015). stargazer: Well-Formatted Regression and Summary Statistics Tables. *R package version 5.2*. Available from:[http://CRAN.R-project.org/package=stargazer] (Accessed on 12 October 2017)
 
Jan D. Andersen (2005) Financial Problems and Divorce - Do Demographic Characteristics Strengthen the Relationship?. *Journal f Divorce & Remarriage*, 43(1-2), 149-161. Available from: doi: 10.1300/J087v43n01_08 (Accessed on 12 October 2017)

John Bingham and Ashley kirk, The Telegraph (2015), *Divorce rate at lowest level in 40 years after cohabitation revolution*. Available from: [http://www.telegraph.co.uk/news/uknews/12011714/Divorce-rate-at-lowest-level-in-40-years-after-cohabitation-revolution.html] (Accessed on 12 October 2017)

NHS Digital (2014) *Statistics on Drugs Misuse: English, 2014* Available from: [http://digital.nhs.uk/catalogue/PUB15943] (Accessed on 11 October 2017)

Office for National Statistics (2015) *Births by parents' characterisitics in England and Wales2015*. Available from: [https://www.ons.gov.uk/peoplepopulationandcommunity/birthsdeathsandmarriages/livebirths/bulletins/birthsbyparentscharacteristicsinenglandandwales/2015] (Accessed on 12 October 2017)

Office for National Statistics (2015) *Divorces in England and Wales: 2015 - Dissolutions and annulments of marriage by previous marital status, sex, age, fact proven and to whom granted*. Available from: [https://www.ons.gov.uk/peoplepopulationandcommunity/birthsdeathsandmarriages/divorce/bulletins/divorcesinenglandandwales/2015] (Accessed on 12 October 2017) 

Office for National Statistics (2017) *Marriage and divorce on the rise at 65 and over*. Available from: [https://visual.ons.gov.uk/marriage-and-divorce-on-the-rise-at-65-and-over/] (Accessed on 12 October 2017)

Qi Xu, Jianning Yu and Zeqi Qiu (2015) The impact of children on divorce risk. *The Journal of Chinese Sociology*, 2(1). Available from: DOI 10.1186/s40711-015-0003-0 (Accessed on 12 October 2017)

Susan L. Brown and I-Fen Lin (2012). The Gray Divorce Revolution: Rising Divorce Among Middle-Aged and Older Adults, 1990-2010. *The Journals of Gerontology*, 67(6), 731-741. Available from: doi: 10.1093/geronb/gbs089 (Accessed on 12 October 2017)

Thomas E.Trail, Benjamin R. Karney (2012). What's (Not) Wrong With Low-Income Marriages. *Journal of Marriage and Family*, 74(3), 413-427. Available from: DOI: 10.1111/j.1741-3737.2012.00977.x (Accessed on 11 October 2017)

U.K. - Daily Mail (2015) *Wish you weren't here: Top ten divorce hot spots across Britain are all by the sea - with Blackpool the worst place to live if you want a happy marriage*. Available from: [http://www.dailymail.co.uk/news/article-3201497/Wish-weren-t-ten-divorce-hot-spots-Britain-sea-Blackpool-worst-place-live-want-happy-marriage.html]. (Accessed on 11 October 2017)

Waite, Linda J, and Lee A Lillard (1991) Children and marital disruption. *American Journal of Sociology*, 96(4):930953. 

Wendy Wang, Pew Research Center (2015) *The link between a college education and a lasting marriage*. Available from: [http://www.pewresearch.org/fact-tank/2015/12/04/education-and-marriage/] (Accessed on 12 October 2017) 



